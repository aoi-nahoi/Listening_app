# 復習機能 - 英語リスニングアプリ

## 概要

復習機能は、ユーザーが間違えた問題を効率的に復習し、学習効果を向上させるための包括的な機能です。

## 主な機能

### 1. 復習センター (`/review`)
- **間違えた問題リスト**: ユーザーが間違えた問題を一覧表示
- **学習統計**: 間違えた問題数、総学習時間、正答率、学習日数を表示
- **スコア推移グラフ**: 過去7日間のスコア推移をチャートで表示
- **学習履歴**: 最近の学習記録を表示
- **回答履歴**: 問題への回答履歴と正誤を表示

### 2. 復習詳細ページ (`/review/<question_id>`)
- **音声再生**: 問題の音声を何度も聞いて復習可能
- **選択肢表示**: 4つの選択肢から正解を選択
- **即座のフィードバック**: 回答後に正誤と正解を表示
- **復習情報**: 間違えた回数、前回のスコア、難易度、復習回数を表示
- **学習ヒント**: 効果的な学習方法のアドバイス

### 3. データ追跡
- **学習ログ**: 全ての学習活動を記録
- **復習回数**: 各問題の復習回数を追跡
- **スコア履歴**: 問題ごとのスコア推移を記録
- **時間追跡**: 学習に費やした時間を記録

## 使用方法

### 復習センターへのアクセス
1. ダッシュボードの「復習」ボタンをクリック
2. または `/review` に直接アクセス

### 問題の復習
1. 復習センターで復習したい問題の「復習」ボタンをクリック
2. 音声を聞いて問題を理解
3. 4つの選択肢から正解を選択
4. 「回答を確定」ボタンをクリック
5. 結果を確認し、必要に応じて再度復習

### 学習進捗の確認
- 復習センターで統計情報を確認
- スコア推移グラフで学習の傾向を把握
- 学習履歴と回答履歴で詳細な進捗を確認

## 技術仕様

### データベースモデル

#### LearningLog
- `user_id`: ユーザーID
- `question_id`: 問題ID
- `score`: スコア
- `user_answer`: ユーザーの回答
- `time_spent`: 学習時間
- `created_at`: 作成日時
- `updated_at`: 更新日時
- `review_count`: 復習回数
- `is_review`: 復習かどうか

#### Question
- `audio_url`: 音声ファイルURL
- `question_text`: 問題文
- `correct_answer`: 正解
- `option_a` ~ `option_d`: 選択肢
- `difficulty_level`: 難易度レベル
- `created_at`: 作成日時

### API エンドポイント

- `GET /review`: 復習ページ表示
- `GET /api/review/wrong-questions`: 間違えた問題取得
- `GET /api/review/learning-history`: 学習履歴取得
- `GET /api/review/answer-history`: 回答履歴取得
- `GET /api/review/question/<id>`: 問題詳細取得
- `POST /api/review/start`: 復習開始
- `POST /api/review/save-result`: 復習結果保存
- `GET /review/<id>`: 復習詳細ページ表示

## セットアップ

### 1. データベースマイグレーション
```bash
# 新しいフィールドを追加
flask db upgrade
```

### 2. 依存関係
- Chart.js (スコアグラフ表示用)
- Bootstrap 5 (UI フレームワーク)
- Font Awesome (アイコン)

### 3. ファイル構成
```
templates/
├── review.html          # 復習センター
└── review_detail.html   # 復習詳細ページ

static/
├── css/
│   └── review.css      # 復習機能用スタイル
└── js/
    └── review.js       # 復習機能用JavaScript

migrations/
└── versions/
    └── add_review_fields.py  # データベースマイグレーション
```

## カスタマイズ

### スコア計算の調整
- `app.py`の`get_wrong_questions`関数で間違いの判定基準を調整
- 現在は100点未満を間違いとみなしています

### 表示件数の調整
- `get_learning_history`と`get_answer_history`で`limit(20)`を調整

### グラフの期間調整
- `review.js`の`generateSampleScoreData`関数で表示期間を調整

## 今後の拡張予定

1. **間違いパターン分析**: 間違えやすい問題の傾向を分析
2. **適応的復習**: 忘却曲線に基づく最適な復習タイミングの提案
3. **復習スケジュール**: 定期的な復習のリマインダー機能
4. **学習効果測定**: 復習前後のスコア改善度の測定
5. **グループ学習**: 他のユーザーとの学習状況比較

## トラブルシューティング

### よくある問題

1. **音声が再生されない**
   - ブラウザの音声再生権限を確認
   - 音声ファイルのパスが正しいか確認

2. **グラフが表示されない**
   - Chart.jsが正しく読み込まれているか確認
   - コンソールでエラーメッセージを確認

3. **データが表示されない**
   - データベースに学習ログが存在するか確認
   - APIエンドポイントが正しく動作しているか確認

### ログの確認
- アプリケーションログでエラーメッセージを確認
- データベースクエリの実行状況を確認

## サポート

問題が発生した場合は、以下を確認してください：
1. アプリケーションログ
2. ブラウザのコンソール
3. データベースの状態
4. APIエンドポイントの動作状況
